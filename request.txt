SELECT (SELECT `название_продукта` FROM `Продукт` WHERE `Рецепт_код_продукта` = T.`Продукт_Рецепт_код_продукта` LIMIT 1) as PRODUCT,
    T.`дата_поставки`,
    T.`стоимость`,
    (SELECT AVG(t1.`стоимость`) FROM `Поставки` as t1 WHERE t1.`Продукт_Рецепт_код_продукта` = T.`Продукт_Рецепт_код_продукта` and t1.`код_поставки` <= T.`код_поставки` ORDER BY t1.`дата_поставки` ASC ) AS Averg
FROM `Поставки` as T
ORDER BY T.`Продукт_Рецепт_код_продукта`, T.код_поставки, T.`дата_поставки` ASC